Feature: GUARD platform yml file health status

  As an Infracoder developing a command line tool
  I want to test the accuracy of the files created by the GENERATE command as edited
  In order to maintain the health of the elevage platform desired state files

  Scenario: Guard command processes healthy desired state documents

    Given a file named "platform.yml" with:
    """
    platform:
      name: default_app
      description: Description of the default_app

      environments:
        - dev

      tiers:
        - web

      nodenameconvention:
        - 'node'
        - instance

      pool:

        vmdefaults: &vmdefaults
          count: 2
          tier: web
          image: 'image_name'
          compute: devweb


      components:

        component:
          <<: *vmdefaults
          port: 80
    """
    Given a file named "infrastructure/vcenter.yml" with:
    """
    vcenter:
      name: default_app

      nonprod: &default
        geo: west
        timezone: 085

        host: 'vcenter.example.com'
        datacenter: 'development'
        imagefolder: 'default_app_templates'
        destfolder: 'default_app/dev'
        resourcepool: 'web_apps'
        appendenv: false
        appendtier: false
        datastores:
          - DevStore01

        domain: example.com
        dnsips:
          - 10.1.0.10

      prod:
        <<: *default
        datacenter: 'production'
        destfolder: 'default_app'
        datastores:
          - ProdStore01
        dnsips:
          - 10.0.0.10
    """
    Given a file named "infrastructure/network.yml" with:
    """
    network:
      name: default_app

      devweb:
        vlanid: DEV_NET
        gateway: '10.1.0.1'
        netmask: 19

      devapp:
        vlanid: PRD_NET
        gateway: '10.0.0.1'
        netmask: 19
    """
    Given a file named "infrastructure/compute.yml" with:
    """
    compute:
      name: default_app

      default: &default
        cpu: 1
        ram: 2

      devweb:
        <<: *default

      prodweb:
        <<: *default
        ram: 10
    """
    When I run `elevage guard`
    Then the output should display Healthy in the results from the guard health check
    And the exit status should be 0